
<!-- saved from url=(0051)file:///E:/%D0%A0%D0%9E%D0%A2%D0%90%D0%A0/dots.html -->
<html><!--
        Todo:
            Stop/continue functionality
            Pan
            Add different generators
            Allow entry of numerical parameters
            Parameters on URL
    --><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><title>dots</title>
<style>
    .row1 { margin: 10px; display: block; }
    form { display: table; width: 90%; }
    form p { display: table-row; }
    form label { display: table-cell; text-align: right; width: 5%;}
    form input { display: table-cell; width: 100%; }
    form span { display: table-cell; width: 5%;}
    body { margin: 0; }
    .normalpage { margin: 5px; }
    #canvas { position:fixed; left:0;top:0; width:100%; height:100%; z-index: -1; }
</style>
<script>
var width = 800;
var height = 600;
var marg = 10;
var canvas, ctx;
function getvalue(s) {
    r = +document.getElementById(s).value;
    document.getElementById("show"+s).innerText = r;
    return r;
}
function drawcirc(ctx, x, y, r) {
    ctx.beginPath();
    ctx.arc(x, y, r, 0, 2*Math.PI, false);
    ctx.stroke();
}
var ar, br, an, bn, sep, ax, ay, bx, by, sc;
var deepest = 0;
var renderlim = 300;
var pallete = [];
var eps = 1e-9;
var epseps = eps * eps;
var san, can, sbn, cbn, pts, ox, oy, ord, p, drawit, mindist, incirc, x, y, ii, state=0;
var stopped = true;
var stoptime;
var zoom = 10;
function doanim() {
    width = canvas.clientWidth;
    height = canvas.clientHeight;
    canvas.width = width;
    canvas.height = height;
    ar = getvalue("arad");
    br = getvalue("brad");
    an = getvalue("an");
    bn = getvalue("bn");
    sep = getvalue("dist");
    zoom = getvalue("zoom");
    var h = Math.max(ar, br) * 2;
    var w = ar + br + sep;
    sc = Math.min((height*zoom-2*marg)/h, (width*zoom-2*marg)/w);
    ay = height / 2;
    ax = width / 2 - 0.5 * (sep + br - ar) * sc;
    ax = Math.floor(ax) + 0.5;
    ay = Math.floor(ay) + 0.5;
    by = ay;
    bx = ax + sep * sc;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawcirc(ctx, ax, ay, ar * sc);
    drawcirc(ctx, bx, by, br * sc);
    deepest = 0;
    renderlim = 300;
    state = 0;
    stoptime = performance.now() + 1000 * 60 ; // stop after 60s
    if (stopped) {
        stopped = false;
        requestAnimationFrame(dowork);
    }
    return false; // suppress submit
}
// state 0: pick a new point and initialize
// state 1: chase through points, and accumulate
// state 2: render
var timelim = 13; // max work milliseconds per anim call
var h1=0;
var h2=0;
var h3=0;
function dowork() {
    var start = performance.now();
    if (start > stoptime) {
        stopped = true;
    } else {
        requestAnimationFrame(dowork);
    }
    while (1) {
        if (state == 0) {
            while (1) {
                x = (2 * Math.random() - 1);
                y = (2 * Math.random() - 1);
                if (Math.hypot(x, y) < 1) {
                    if (Math.random() < 0.5) {
                        x = ar*x;
                        y = ar*y;
                    } else {
                        x = br*x+sep;
                        y = br*y;
                    }
                    break;
                }
            }
            san = Math.sin(Math.PI * 2 / an);
            can = Math.cos(Math.PI * 2 / an);
            sbn = -Math.sin(Math.PI * 2 / bn);
            cbn = Math.cos(Math.PI * 2 / bn);
            pts = [];
            ox = x;
            oy = y;
            ord = 0;
            p = [];
            drawit = false;
            mindist = 1000;
            incirc = false;
            state = 1;
            ii = 0;
        }
        if (state == 1) {
            var sqrt = Math.sqrt;
            for (; ii<renderlim; ii++) {
                if ((ii & 8191) == 0 && performance.now() - start > timelim) {
                    return;
                }
                var t = sqrt(x * x + y * y) - ar;
                if (t <= 0) {
                    t = - t;
                    incirc = true;
                    var nx = x * can + y * san;
                    y = y * can - x * san;
                    x = nx;
                }
                if (t < mindist) {
                    mindist = t;
                }
                x -= sep;
                var t = sqrt(x * x + y * y) - br;
                if (t <= 0) {
                    t = - t;
                    incirc = true;
                    var nx = x * cbn + y * sbn;
                    y = y * cbn - x * sbn;
                    x = nx;
                }
                if (t < mindist) {
                    mindist = t;
                }
                var xx = (x + sep) * sc + ax;
                if (xx + mindist >= 0 && xx - mindist <= width) {
                    var yy = y * sc + ay;
                    if (yy + mindist >= 0 && yy - mindist <= height) {
                        p.push((x + sep) * sc + ax, y * sc + ay);
                    }
                }
                ord++;
                var dx = x + sep - ox;
                if (dx * dx < epseps) {
                    var dy = y - oy;
                    if (dx * dx + dy * dy < epseps) {
                        drawit = true;
                        break;
                    }
                }
                x += sep;
            }
            mindist *= sc;
            if (!drawit && renderlim < 1000000) {
                deepest = renderlim;
                document.getElementById("order").innerText = ">" + deepest;
                renderlim = Math.floor(renderlim * 1.03);
            }
            if (!incirc || !drawit) {
                state = 0;
            } else {
                state = 2;
                ii = 0;
            }
        }
        if (state == 2) {
            if (ord > deepest) {
                deepest = ord;
                document.getElementById("order").innerText = deepest;
            }
            if (!pallete[ord]) {
                var cr = ord * 154 % 251;
                var cg = ord * 230 % 241;
                var cb = ord * 214 % 239;
                pallete[ord] = "rgb(" + cr + "," + cg + "," + cb + ")";
            }
            ctx.fillStyle = pallete[ord];
            if (mindist < 1.5) {
                for (; ii<p.length; ii += 2) {
                    if ((ii & 8191) == 0 && performance.now() - start > timelim) {
                        return;
                    }
                    ctx.fillRect(p[ii], p[ii+1], 1, 1);
                }
            } else {
                for (; ii<p.length; ii += 2) {
                    if ((ii & 8191) == 0 && performance.now() - start > timelim) {
                        return;
                    }
                    ctx.beginPath();
                    ctx.arc(p[ii], p[ii+1], mindist-0.5, 0, 2*Math.PI, false);
                    ctx.fill();
                }
            }
            state = 0;
        }
    }
}
function togglevis() {
    var s = document.getElementById("row1").style;
    console.log(s.display);
    if (!s.display || s.display === "block") {
        s.display = "none";
        document.getElementById("toggleui").innerText = "Show Sliders"
    } else {
        s.display = "block";
        document.getElementById("toggleui").innerText = "Hide Sliders"
    }
}
var sliders = ["arad", "brad", "an", "bn", "dist", "zoom"];
function dorandom() {
    while (1) {
       var arad = (1000 + Math.floor(9001 * Math.random())) / 1000;
       var brad = (1000 + Math.floor(9001 * Math.random())) / 1000;
       var dist = (1 + Math.floor(10000 * Math.random())) / 1000;
       if (arad + brad > dist) {
          document.getElementById("arad").value = arad;
          document.getElementById("brad").value = brad;
          document.getElementById("dist").value = dist;
          break;
       }
    }
    document.getElementById("an").value = 2 + Math.floor(19 * Math.random());
    document.getElementById("bn").value = 2 + Math.floor(19 * Math.random());
    document.getElementById("zoom").value = (100 + 401 * Math.random() * Math.random()) / 100;
    doanim();
}
function start() {
    canvas = document.getElementById("canvas");
    ctx = canvas.getContext("2d");
    for (var s of sliders) {
        document.getElementById(s).oninput = doanim;
    }
    document.getElementById("toggleui").onclick = togglevis;
    window.onresize = doanim;
    dorandom();
}
window.onload = start;
</script>
    </head>
    <body>
        <canvas id="canvas" width="1912" height="956"></canvas> <!-- in background -->
    <div class="normalpage">
    <div class="row1" id="row1"><form>
        <p><label for="arad">Radius A:&nbsp;</label>
            <span id="showarad">1.511</span>
            <input id="arad" type="range" step="0.001" min="1" max="10" value="2">
        </p>
        <p><label for="an">Spin A:&nbsp;</label>
            <span id="showan">4</span>
            <input id="an" type="range" step="1" min="2" max="20" value="7">
        </p>
        <p><label for="brad">Radius B:&nbsp;</label>
            <span id="showbrad">1.338</span>
            <input id="brad" type="range" step="0.001" min="1" max="10" value="2">
        </p>
        <p><label for="bn">Spin B:&nbsp;</label>
            <span id="showbn">5</span>
            <input id="bn" type="range" step="1" min="2" max="20" value="7">
        </p>
        <p><label for="dist">Separation:&nbsp;</label>
            <span id="showdist">1.907</span>
            <input id="dist" min="0" step="0.001" max="10" type="range" value="2.4">
        </p>
        <p><label for="zoom">Zoom:&nbsp;</label>
            <span id="showzoom">1</span>
            <input id="zoom" min="1" step="0.01" max="20" type="range" value="1">
        </p>
    </form>
    <span id="order">11</span> order
    </div>
    <div><button type="button" id="toggleui">Hide Sliders</button></div>
    </div>
    

</body></html>